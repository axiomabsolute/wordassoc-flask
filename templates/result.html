{% if debugMode %}
{% extends "layout.html" %}
{% endif %}
{% block body %}
    <div class="report-content">
        <div class="row">
            <h2>How'd you do?</h2>
            <h2>{{ correct_answers }} answer correct out of {{ total_answers }}</h2>
            <h2>Score: {{ game_score }}</h2>
            <h2>Current Standing: {{ standing }} of {{ total_games }}</h2>
        </div>
        <div class="row">
            <div id="questionCountsByType"></div>
        </div>
        <div class="row">
            <ul>
                {% for tech in accuracyByTech %}
                <li>{{ mapOfQuestionTypesToDisplayName[tech] or tech }} : {{ accuracyByTech[tech]*100 }}%</li>
                {% endfor %}
                {% for type in accuracyByCategory %}
                <li>{{ mapOfQuestionTypesToDisplayName[type] or tech }} : {{ "%.1f" % (accuracyByCategory[type]*100.0) }}%</li>
                {% endfor %}
            </ul>
        </div>
        <div class="row">
            <div id="tech-scores">

            </div>
        </div>
        <div class="row">
            <table>
                <thead>
                    <tr>
                        <th>Question</th>
                        <th>Your Answer</th>
                        <th>Correct Answer</th>
                    </tr>
                </thead>
                <tbody>
                {% for questionResult in questionTableData %}
                    <tr>
                        <td><pre>{{ questionResult["question"] }}</pre></td>
                        <td>{{ questionResult["userAnswer"] }}</td>
                        <td>{{ questionResult["answer"] }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="row">
            <a href="" class="button">Done</a>
            <a href="/leaderboard" class="button">Leaderboard</a>
        </div>
    </div>
    <script type="text/javascript">
        window.WordAssoc = window.WordAssoc || {};
        var visualization_data = {{ visualization_data|safe }};
        window.WordAssoc["visualization_data"] = visualization_data;

        console.log(visualization_data);

        {% if debugMode %}

        function renderPie(data, valueKey, labelKey, selector){
            var width = 400,
                height = 400,
                radius = Math.min(width, height)/2;

            var color = d3.scale.ordinal()
                .range(["98abc5", "#8a89a6", "7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"]);

            var arc = d3.svg.arc()
                .outerRadius(radius - 10)
                .innerRadius(0);

            var pie = d3.layout.pie()
                .sort(null)
                .value(function(d){ return d[valueKey]; });

            console.log(data);

            var svg = d3.select(selector).append("svg")
                        .attr("width", width)
                        .attr("height", height)
                        .append("g")
                        .attr("transform", "translate(" + width/2 + "," + height /2 + ")");

            var g = svg.selectAll(".arc")
                        .data(pie(data))
                        .enter().append("g")
                        .attr("class", "arc");

            g.append("path")
                .attr("d", arc)
                .style("fill", function(d) { return color(d.data[labelKey]); });

            g.append("text")
                .attr("transform", function(d) { return "translate(" + arc.centroid(d) + ")"; })
                .attr("dy", ".35em")
                .style("text-anchor","middle")
                .text(function(d) { return d.data[labelKey]; });
        }

        //renderPie(visualization_data["accuracyByTech"], "accuracy", "tech", "#accuracyByTechPie");
        renderPie(d3.map(visualization_data["questionCountsByType"]).entries(), "value", "key", "#questionCountsByType");

        {% endif %}

    </script>
{% endblock %}
